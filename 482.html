<!DOCTYPE html>
<html>
    <head>
        <base href="https://cdn.jsdelivr.net/gh/genizy/web-port@main/human-expenditure-program/">
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="user-scalable=no">
        <link rel="icon" href="icon/icon.png" type="image/png">
        <link rel="apple-touch-icon" href="icon/icon.png">
        <link rel="stylesheet" type="text/css" href="css/game.css">
        <title>HUMAN EXPENDITURE PROGRAM</title>
    </head>
    <body style="background-color: black">
        <script type="text/javascript" src="js/main.js"></script>
    </body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <script>
        // full screen the game ----------------------------------------------------------
        function applycanvasmode() {
            let w = 0;
            let h = 0;
            let maxW = window.innerWidth;
            let maxH = window.innerHeight;
            if ((maxW * 0.75) > maxH) {
                h = maxH;
                w = Math.floor((maxH / 3) * 4);
            } else {
                w = maxW;
                h = Math.floor((maxW / 4) * 3);
            }
            try {
            document.querySelector("#gameCanvas").style.width = w + "px";
            document.querySelector("#gameCanvas").style.height = h + "px";
            document.querySelector("#gameVideo").style.width = w + "px";
            document.querySelector("#gameVideo").style.height = h + "px";
            document.querySelector("#mouseCanvas").style.width = w + "px";
            document.querySelector("#mouseCanvas").style.height = h + "px";
} catch(e) {}
        }
        setInterval(applycanvasmode, 100);

        // support mobile ----------------------------------------------------------------
    (function () {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (!isMobile) {
            return;
        }
        
        let i = setInterval(function () {
            if (true) {
                let zoneStatic = document.createElement("div");
                zoneStatic.style = "position: fixed; bottom: 0; left: 0; z-index: 9999; width: 500px; height: 500px;";
                let internal = document.createElement("div");
                internal.style = "position: relative; width: 100%; height: 100%;"
                zoneStatic.appendChild(internal);
                let joystick = nipplejs.create({
                    mode: 'semi',
                    zone: internal,
                    color: 'red',
                    catchDistance: 30
                });
                function sendKeyEvent(key, type = "keydown") {
    const event = new KeyboardEvent(type, {
        key: key,
        code: key,
        bubbles: true
    });
    document.dispatchEvent(event);
}
                setTimeout(function () {
                    joystick.on("dir", function (e, data) {
                        let dirs = ["up", "down", "left", "right"];
                        for (let o of dirs) {
                            if (o !== data.direction.angle) {
                                sendKeyEvent(o, "keyup");
                            } else {
                                sendKeyEvent(o, "keydown");
                            }
                        }
                    });
                    joystick.on("end", function () {
                        let dirs = ["up", "down", "left", "right"];
                        for (let o of dirs) {
                            sendKeyEvent(o, "keyup");
                        }
                    });
                }, 100);
                document.body.appendChild(zoneStatic);

                // button creator
                const createButton = (text, key, bottom, right, bgColor) => {
                    let button = document.createElement("div");
                    button.style = `
                        position: fixed; 
                        bottom: ${bottom}; 
                        right: ${right}; 
                        width: 10vw; 
                        height: 10vw; 
                        background: ${bgColor}; 
                        color: white; 
                        touch-action: none; 
                        z-index: 999999; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-family: sans-serif; 
                        font-size: 3vw;
                        border-radius: 50%;
                    `;
                    button.innerText = text;
                    button.addEventListener("touchstart", function (e) {
                        e.preventDefault();
                        sendKeyEvent(key, "keydown");
                    });
                    button.addEventListener("touchend", function (e) {
                        e.preventDefault();
                        sendKeyEvent(key, "keyup");
                    });
                    document.body.appendChild(button);
                    return button;
                };

                // new arrow buttons
                createButton("↑", "up", "25vw", "10vw", "#08f8");
                createButton("↓", "down", "5vw", "10vw", "#08f8");
                createButton("←", "left", "15vw", "20vw", "#08f8");
                createButton("→", "right", "15vw", "0vw", "#08f8");

                // enter button
                createButton("ENTER", "enter", "25vw", "25vw", "#880f");

                clearInterval(i);
            }
        }, 100);
    })();
    </script>
</html>




